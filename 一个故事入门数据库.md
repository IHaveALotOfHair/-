# 一个故事入门MySql

本章从作者在自己写的智能家居和电脑通信后，遇到数据持久化的问题，换句话说就是用数据库存数据是目前已知最方便且可拓展的做法，以此为背景学习了数据库建表，改表，增删改查数据的基本操作，并以故事与笔记的形式记录下来。

考虑到单纯的学习增删改查一打开看到的全是新的术语，多数人可能并不愿意看，看视频有时出发的角度也不已满足日常使用需求为主，本文尝试通过看一套故事，带读者尽量快乐的快速了解数据库的基本操作，其中讲述了部分故事，故事与数据库的基本概念基本对应，希望通过类比的方式带读者快速了解数据库的基本概念，中间部分提供了可运行的代码与代码运行结果展示，希望对读者有所帮助

## 0.前言

关于数据库的安装与登录，教程有很多，本章不在赘述，这里推荐一个已有教程：

作者数据库的开发环境：

- widows10（x86)

- Mysql8.0

- IDE：DataGrip

#### 关于开发工具：

sql语句其实是一种工具类型的语句，我们不用官它的底层实现，按格式输入一些命令就可以得到结果，用c和sql对比，c是造车的，sql是开车的，我们学开车如果有一辆操作麻烦的车还有一辆操作简单功能强大的好车可以学（且价格一样），那肯定是选好车啊。所以在用命令行操作sql与用带代码提示的集成开发工具之间肯定是选择集成工具。

入门嘛，管它什么方法，越简单越快速入门越好，这是个效率问题。



  由于本人对感觉没有必要的东西毫无兴趣，所以，我打算通过结合一点小应用的方式来讲述mqsql的使用，这样大家在学习数据库的同时还可以做一些对自己有用的事情，同时学的也快乐，岂不美哉！

### 为什么要用数据库？

假设我们现在自己用ESP8266芯片编写了一些智能家居，把这些智能家居和我们的电脑建立通讯后，为了实现对这些家居信息的统计于持久化，我们需要把智能家居的数据储存起来，包括所在房间名，家居信息等等，这样，即使我们的电脑和家居重新启动，电脑依然能找到家居的信息，而不需要给硬件端编写及其复杂的逻辑去存储信息，同样，我们可以使用一些后端技术连接数据库，并对信息进行维护。

当然，如果现在没学到硬件或者是后端技术也无妨，只要你想做一个自己专属的智能家居系统，这个表后边还是有作用的。

### 

我要实现记录屋内24小时温度值并在想看的时候展示，在不用数据库的时候，我可能要开一个python脚本，每隔一段时间与硬件通信一次，保存信息，然后存到本地，用的时候从本地读取最近的数据。

这样有点不好，我得24小时开着脚本，还容易不小心把程序关了，如果说我都手机也要看到这个24小时内的温度变化图，我还得用电脑和手机建立通讯，把文件读了发给手机。

几个数据还好，如果数据多了，操作起来很麻烦，在自己试过一些次数后，我发现还是用数据库来的方便。这样一来，我后台开一个后端程序，不停的把我要的数据存到表里，然后哪里要用数据就从表里去取，很是方便。

而且数据库表的结构一定程度上帮忙理清了数据的逻辑，用起来很方便。

### 准备开始：

到这里，我的目的是建立一个方便和其它后端技术对接的，用来持久记录数据的表，它只需要帮我记录我自己编写的智能家居的信息就好了，同时我还要知道如何在表中增加家居的数据，修改家居的数据，以及查询家居的数据。

**说白了，我想通过用数据库让电脑帮我自动把家居的信息存到表格里，我要做的，就是建立一个表，然后告诉电脑数据该怎么填进去**

### 开始吧~

## 1.建表与表头的操作

一开始入门数据库大概是想着建一个表，然后增删改查，像是用excel那样，只不过是换成了指令。其实数据库在宏观来看结构还是很简单的。

数据库就像是一个文件夹，文件夹里边夹了好多表，所以说，虽然我们目前仅仅用到一张表，但我们还是要用一个文件夹（数据库），把表装进去。

我们使用数据库建表，和用excel建表有一些区别，我们需要提取告诉数据库我们要存入的内容是什么格式，比如说我们买了一箱冰棍和一张桌子，要放到家里，我们知道要放这些东西需要占用空间，冰棍要放到冰箱里冷藏，桌子可以找个空间大点的地方要不然放不下。

数据存入数据库相当于我们把一箱冰棍和桌子存到朋友家里，存之前对于朋友来说他不知道要存的是什么东西，我们去了要告诉他是一箱冰棍还有桌子，要不然万一朋友家里没有买冰箱，或者是桌子太大搬不进去，我们的东西就存不进去了。

对于数据库而言，他也不知道我们要存的东西是啥，所以要提前声明一些存放东西的方式和空间，比如存冰棍要提前买几个大冰箱，存桌子要提前留几块门够大的厂房。

那要是不提前声明会怎么样呢？

这就相当于提前拿了一箱子冰棍东西大老远跑到朋友家，说我这箱子冰棍就放你这了，你可以随便吃。结果发现他家里没有冰箱，放不了，白跑了一趟。就数据库来说（这个阶段具体说还不能叫数据库），你这发了好大一个包，中间传输好几十公里，结果那边只有一点空间存放，存不进去，然后他就不会了，这时候又丢过来十几个来历不明的大包，一直存不进去，诶，太难受了直接罢工，这不就寄了。

这时候，我们就和数据库那边做个约定，我把一堆包整理成一个固定的格式，每个包大小与类型提前告诉他，这样，他可以提前做准备来存放这些包，不至于因为混乱没地方放了。

这里就引入数据类型的概念：

- 我们需要告诉数据库包裹的类型，

比如说类型是西瓜，他就知道这是用来吃的，吃之前先切开，瓜皮一般不会生吃，

- 以及大小，知道是多大的西瓜，好提前准备买一个大冰箱，一个格子放一个西瓜，这样，每一个西瓜都能放到格子里。

回到这里，我们现在把家居的信息存入数据库，主要就是存一些字符串和数字。

我们使用大家都在用的MYSQL，一般来说大家都用的工具多是用起来方便且功能强大，到这里，我们就知道建一个包含家居信息的表表要提前告诉MYSQL表放到那个文件夹（数据库)里，然后表中要有哪些信息（一次发过来一个西瓜一个冰棍和桌子），信息的类型是什么（西瓜要怎么吃），以及表中信息的占据的空间（西瓜最大的有多大）。

**这里，我们要建一个数据库，然后再在数据库中建一个表。**

```mysql
create database 我的智能家居;#创建数据库
use 我的智能家居;#我们进入到数据库内进行操作
#建一个表
create table 家居(
     #表头名称，名称类型
    家居编号 int,   
    家居名 varchar(50),
     #var： variable可变的 ，char:字符串 varchar 可变的字符串
    # varchar(n) 中括号中 n 代表字符的个数，并不代表字节个数，比如 CHAR(30) 就可以存储 30 个字符。
    家居类型 varchar(50),
    家居在我的哪个家里 varchar(50),
    家居在我家哪个房间 varchar(50),
    家居在房间那个位置 varchar(50)
               );
```

学过英语的我们发现sql语句很有规律，我们只要找个例子仿写，就能自己建自己需要的表了。

**在这里关于数据类型的详细信息，我们可以取菜鸟教程中查看总结好的具体信息，非常方便。**

[MySQL 数据类型 | 菜鸟教程 (runoob.com)](https://www.runoob.com/mysql/mysql-data-types.html)

注意，sql语句不区分大小写，换句话说就是大写小写没区别。

看到上边你会发现，我一开始想记录连续24小时的温度信息，现在会建表了，顺便把家居信息也记录了，先理清逻辑后边就省事了。

建好了之后我们可以看一下建的怎么样。

```mysql
describe 家居;
```

![2Qy2v.png](https://s1.328888.xyz/2022/04/21/2Qy2v.png)

是不是很形象，我们要看表建立的信息，就输入describe（描述） 表。

作为一个新手要建一个表，我们可能一开始建的表建错了，比如我现在发现`家居在我的哪个住`所这个表头完全没必要，我现在连房子都没有，看到这个表头我就伤心，所以我打算去掉他。

```mysql
alter table 家居 drop 家居在我的哪个家里;
describe 家居;
```

![2QHvT.png](https://s1.328888.xyz/2022/04/21/2QHvT.png)

我们看到，我们成功删掉了令我们伤心的表头。

这时，突然想起来，自己做的家居有的会不停发送家里的温度的信息，或者是湿度等等，有的只是接收开关指令，相当于一个可以隔空控制的开关。

后边些逻辑的时候发现用到到这串信息，所以再给表加一列。

关于修改表头（字段的教程详情可以点开下面部分查看）的

[mysql如何给表中添加列（字段）？-mysql教程-PHP中文网](https://www.php.cn/mysql-tutorials-460359.html#:~:text=mysql给表中添加列的方法：1、使用“ALTER TABLE 表名 ADD 新字段名 数据类型 [约束条件]%3B”在末尾添加列；2、使用“ALTER TABLE,数据类型 [约束条件] FIRST%3B”在开头添加列。 MySQL 数据表是由行和列构成的，通常把表的“列”称为字段（Field），把表的“行”称为记录（Record）。 随着业务的变化，可能需要在已有的表中添加新的字段。 MySQL 允许在开头、中间和结尾处添加字段。)

[mysql怎么删除表字段-mysql教程-PHP中文网](https://www.php.cn/mysql-tutorials-470558.html)

```mysql
alter table 家居 add 家居发过来的信息有几种 tinyint;
#ALTER TABLE <表名> ADD <新字段名> <数据类型> [约束条件] AFTER <已经存在的字段名>;也可以用这种方法在任意表头位置后增加字段
describe 家居;
```

![2Qz3C.png](https://s1.328888.xyz/2022/04/21/2Qz3C.png)

我们发现，这时候成功增加了一个表头进来。

```
alter：改变 
我们发现这个逻辑很简单：
改变表 增加(或者是别的命令) 表头信息
```



因为新手学，建表可能建的表头有点长，这时候我想把`家居在我家哪个房间`

修改成`家居所在房间`，改完之后我想到万一我给房间起了一个很不靠谱的名字比如说`宇宙无敌风暴战神狂龙战士666666`这样的名字，或者不小心给房间名取名成一首诗，这50个字符可能不够用，于是我好像修改这个名字的长度，请看我如何操作：

```mysql
alter table 家居 change 家居在我家哪个房间 家居所在房间 varchar(50);
alter table 家居 modify 家居所在房间 varchar(100);
describe 家居;
```

![2QRLO.png](https://s1.328888.xyz/2022/04/21/2QRLO.png)

关于表头的具体信息可参考这个教程：

[MySQL修改/删除字段 (biancheng.net)](http://c.biancheng.net/view/7584.html)

到目前为止，我们初步掌握了数据库如何建库，如何建各种各样的表，以及一旦表没建好，该如何修改表头信息，恭喜您，现在您可以仿照上述的语法，建立任意自己想要的表了。



## 2.在表中操作数据

在上一小节我们成功学会了如何建立自己需要的表。终于，到目前我们成功的为家居具体信息的维护搭建了环境，下面我们只需要使用一些简单的语句就可以完成对我们智能家居信息的增删改查了。

到这里，我们的表单刚刚建好，他现在空空如也，用过一些后端的朋友可能知道，在后端对数据库操作的往往会把sql语句送到数据库那边，然后等待结果。一开始用java后端想着为啥不把这些封装成java语法的方法，还要学sql语句，现在发现，sql语句原理这么简单，简单到用一遍就能会，根本没必要封装成java方法。

详细信息你可以参考这个教程：

[MySQL之增删改查 - 白居不易1101 - 博客园 (cnblogs.com)](https://www.cnblogs.com/heyangblog/p/7624645.html)

### 1.增

让我们给表中加入一个家居，并看看加进去长啥样。

```mysql
use 我的智能家居;
insert into 家居 (家居编号, 家居名, 家居类型, 家居所在房间, 家居在房间那个位置,家居发过来的信息有几种)
values          (001,'自治温湿度计','温度计','客厅','在门口',3);
select * from 家居;
```



![2QkRv.png](https://s1.328888.xyz/2022/04/21/2QkRv.png)

```
上面的sql语句翻译过来就是先打开`我的智能家居`这个数据库，
往家居这张表的（这些表头里边）增加（表头对应的）这些数据。
然后选中表里所有信息拿过来看看
```

当然，测试阶段，我懒得写后边那么多信息，我还可以这样增加信息：

```mysql
insert into 家居 (家居编号, 家居名)
values          (002,'开关');
select * from 家居;
```

![2QbXJ.png](https://s1.328888.xyz/2022/04/21/2QbXJ.png)

我也可以这样加入信息：

```mysql
insert into 家居  values          
(003,'电动窗帘','电机','客厅','在门口',3);
insert into 家居 (家居编号, 家居名)
values          (002,'开关2') ,(003,'开关3'),
                (004,'开关4'), 
                (005,'开关5'), 
                (006,'开关6'), 
                (007,'开关7');
select * from 家居;

```

![2ULMt.png](https://s1.328888.xyz/2022/04/21/2ULMt.png)



这时候我们发现我们如果不写要加入的表头的信息，要一下子把所有表头信息输入进去；
如果懒得添加了也可以，但是每次都会是新增一行，信息重复也会新增一行，
如果信息不全也可以新增一行数据。

但如果我们增加一个超出建表时规定的数据会怎样呢？

我们来看这个例子

![2UrFq.png](https://s1.328888.xyz/2022/04/21/2UrFq.png)

我们发现，他会报一个`Data truncation: Out of range`错误，意思就是超过最大值了，我们`家居发过来的信息有几种`这个表头的时候给的数据类型是tinyint（8位），也就是说最大值是+127，666显然超出太多，所以加不进去。

以上我们通过几个测试，测试出来我们的数据库增加数据可以这么用，有以上那么几种增加数据的方式，不管值全不全，只要值在表的字段（表头）范围内，都能加进去。

### 2.删

上边我们测试加入了那么多数据，其实只有第一条和第三条是差不多符合实际情况的，这时候我们想删除掉刚才哪些随便加进去的测试信息，我们可以这样做。

```mysql
delete from 家居  where  家居编号>4;
select * from 家居;
```

![2UDTi.png](https://s1.328888.xyz/2022/04/21/2UDTi.png)

删除家具类型为空的列：

```mysql
delete from 家居  where  家居类型 is null;
select * from 家居;
```

![2UdMv.png](https://s1.328888.xyz/2022/04/21/2UdMv.png)

但这里我们发现一个令人头大的问题，我们发现之前不小心添加了一个重复的行进去，如果用delete where 编号=3语句，那就这俩都给删了，用复杂的语句只保留一条咱作为新手增删改都没搞完，上来就用那个确实麻烦，不过好在我们这里数据量小，我们只需要把编号给改成4，然后把这个删了就好。

我们写用这个数据库毕竟都是自己写智能家居的后端把数据输入进去，以后增加数据的适合可以考虑做个是否同名的检查，如果不想让同名的同名了就不加进去了，当然，这是后话。

下面，我们来改一下这个数据，让他看起来舒服点。

### 3.改

这时候，我发现之前想把家居编号改了，但这俩里边所以的内容都一样，也就是说，无论咋改，他俩都是同步改了的，为了区分，我们再加一列id把它填到头部，并把id设置为主键，并且让主键自增

```mysql
alter table 家居 add id int primary key  auto_increment FIRST ;
select * from 家居;
```

![2exe7.png](https://s1.328888.xyz/2022/04/21/2exe7.png)

添加完了之后发现，这俩就有的区分了，我们可以修改家居家居的编号，把他俩修改成不一样的

mysql改的教程可以参考如下：

[MySQL UPDATE 更新 | 菜鸟教程 (runoob.com)](https://www.runoob.com/mysql/mysql-update-query.html)

```mysql
update 家居 set 家居编号=2,家居名='电动窗帘左' where id=2;
update 家居 set 家居编号=3,家居名='电动窗帘右' where id=3;
select * from 家居;
```

总的来看，逻辑依旧清晰，更新表家居，把id=2的地方（这个在后边）的家居编号改成2，家具名改成电动窗帘左。

下一句也是这个逻辑。

最后展示一下效果。

妙啊，到现在，我们可以增删改数据了，其实我们还是会一点点查数据的，你看上边的select语句，其实那个就是查数据的。

再看最后一步，就满足我们对智能家居后台数据持久化的日常需求了，真好。

离成功就差一步，加油！

### 4.查

还是先推荐一个教程：

[MySQL 查询数据 | 菜鸟教程 (runoob.com)](https://www.runoob.com/mysql/mysql-select-query.html)

```mysql
select  家居编号,家居名 from 家居 where 家居.id=2;
```

![2uYCT.png](https://s1.328888.xyz/2022/04/21/2uYCT.png)

没错，就是这么简单，其实我们之前用过好多次select语句了，之前我们一直用`selelc * from 家居`来展示更改后的数据，*表示所有字段，现在我们只需要把要查询的字段放在`select`和`from`中间，然后写表名和限制条件即可。

```mysql
select * from 家居 where 家居编号=2;
```

![2uwd7.png](https://s1.328888.xyz/2022/04/21/2uwd7.png)

比如说我们用java构建一个实体类，每次就可以新建一个对象与数据库查到的这一条对接。

其实还有很多高级用法，mysql中还有大量的函数用法，还有正则表达式的一些用法，这些等用的到的时候再学也不迟。

## 3.小结

恭喜您，如果您看完本教程并把所有教程中示例的代码操作一遍的话，相信您已经掌握了mqsql数据库的入门用法，到目前为止，您已经对数据库表，字段，以及表字段的修改，主键设置，表中数据的增删改查有了初步的了解，相信您之后可以轻松根据自己的需求进行简单的数据库操作了。

在最后，我们对之前用到的操作做一个小小的总结，您可以对照总结中的内容，在头脑中重新会议之前用到的操作，这将有助于您的记忆，后续，您也可以通过观看小结，轻松找回之前遗忘的知识。

- 创建表

  ```mysql
  create database 您的数据库名;
  use 您的数据库名;
  create table 您的表名(
      表头1 数据类型，
      表头2 数据类型，
      表头3 数据类型，
      ...
      表头n 数据类型
  );
  #您可以通过以下方式查看您的表的表头信息
  describe 您的表名;
  ```

  

- 修改表头

  关键字alter

  ```mysql
  alter table 您的表名 要进行的操作 
  		   		    add 表头名 表头类型 操作 位置（可不写，默认最后）
  				    change 修改
  				    drop 删除
                      
  ```

  

- 增：关键字insert

  ```mysql
  use 数据库名;
  insert into 表名 (表头1，表头2，表头3，...)
  values         (表头1对应的内容，表头2对应的内容，表头3对应的内容，...);
  #可任意顺序任意数量，对应就行
  select * from 家居;
  ```

  

- 删：关键字delete

  ```mysql
  delete from 表  where  表头 is null;
  where 的用法：
  where 表头n=xx;
  where 表头 is null；
  where 表头 >xx;
  where相当于是if语句，里边其实还可以放很多类型的东西，大家可以搜索查看更高级的用法。
  ```

  

- 改：关键字update

  ```mysql
  update 表 set 表头1=要设置的信息1，表头2=要设置的信息2 where 您要设置的条件
  ```

  

- 查：关键字select

  ```mysql
  select 表头1，表头2 from 表 where 您要设置的条件;
  ```

  

网上对’入门‘的水平要求五花八门，我认为，其实到现在也可以算是入门了，至少您现在碰到有关数据库操作的问题，您查阅资料的时候能较轻松的看懂好多资料了。甚至，您也可以把数据库sql语句操作的问题用您擅长的编程语言来做。

## 4.练习

最后，您可以尝试自己构建一个表，表的内容包括

表名： 自制温湿度计

表中内容：

- id
- 家居名称

- 温度值（浮点数）
- 湿度值（浮点数）
- 上传时间（日期）

您可以尝试用两个您熟悉的编程语言连接该数据库，一个像数据库发送数据，一个接收数据，并打印或画图展示最近30s的数据。



